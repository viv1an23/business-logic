{% use "bootstrap_5_layout.html.twig" %}

{# Widgets #}

{% block datetime_widget -%}
    {% if widget == 'single_text' %}
        {{- block('form_widget_simple') -}}
    {% else -%}
        {% set attr = attr|merge({class: (attr.class|default('') ~ ' form-inline')|trim}) -%}
        <div {{ block('widget_container_attributes') }}>
            {{- form_errors(form.date) -}}
            {{- form_errors(form.time) -}}
            {{- form_widget(form.date, { datetime: true } ) -}}
            {{- form_widget(form.time, { datetime: true } ) -}}
        </div>
    {%- endif %}
{%- endblock datetime_widget %}

{% block date_widget -%}
    {% if widget == 'single_text' %}
        {{- block('form_widget_simple') -}}
    {% else -%}
        {% set attr = attr|merge({class: (attr.class|default('') ~ ' form-inline')|trim}) -%}
        {% if datetime is not defined or not datetime -%}
            <div {{ block('widget_container_attributes') -}}>
        {%- endif %}
        {{- date_pattern|replace({
            '{{ year }}': form_widget(form.year),
            '{{ month }}': form_widget(form.month),
            '{{ day }}': form_widget(form.day),
        })|raw -}}
        {% if datetime is not defined or not datetime -%}
            </div>
        {%- endif -%}
    {% endif %}
{%- endblock date_widget %}

{% block time_widget -%}
    {% if widget == 'single_text' %}
        {{- block('form_widget_simple') -}}
    {% else -%}
        {% set attr = attr|merge({class: (attr.class|default('') ~ ' form-inline')|trim}) -%}
        {% if datetime is not defined or false == datetime -%}
            <div {{ block('widget_container_attributes') -}}>
        {%- endif -%}
        {{- form_widget(form.hour) }}{% if with_minutes %}:{{ form_widget(form.minute) }}{% endif %}{% if with_seconds %}:{{ form_widget(form.second) }}{% endif %}
        {% if datetime is not defined or false == datetime -%}
            </div>
        {%- endif -%}
    {% endif %}
{%- endblock time_widget %}

{% block checkbox_widget %}
    <div class="form-check form-check-inline">
        <input type="checkbox" {{ block('widget_attributes') }} class="form-check-input" id="{{ id }}" {% if value is defined %} value="{{ value }}"{% endif %} {% if checked %} checked="checked"{% endif %} />
        <label class="form-check-label" for="{{ id }}">{{ label|trans({}, translation_domain) }}</label>
    </div>
{% endblock checkbox_widget %}

{% block form_errors -%}
    {% if errors|length > 0 -%}
        {% if form.parent %}<span class="help-block">{% else %}<div class="alert alert-danger">{% endif %}
        <ul class="list-unstyled">
        {%- for error in errors -%}
            <li><span class="glyphicon glyphicon-exclamation-sign"></span> {{ error.message }}</li>
        {%- endfor -%}
    </ul>
        {% if form.parent %}</span>{% else %}</div>{% endif %}
    {%- endif %}
{%- endblock form_errors %}

{% block date_range_widget %}
    <div class="input-group">
            <span class="input-group-text"><i class="ph-calendar"></i></span>
        {{- block('form_widget_simple') -}}
        {% if show_clear_button is defined and show_clear_button %}
                <button class="btn btn-light date_range_reset" id="date_range_reset" data-bs-id="{{ id }}" type="button">RESET</button>
        {% endif %}
    </div>
    <script>
        $(document).ready(function (){
            let dp = $('#{{ id }}');

            let timeFormat = {% if is_datetime %}'YYYY-MM-DD HH:mm:ss'{% else %}'YYYY-MM-DD'{% endif %};
            let timePicker = {% if is_datetime %}true{% else %}false{% endif %};

            dp.daterangepicker({
                parentEl: '.content-inner',
                timePicker: timePicker,
                timePicker24Hour: true,
                locale: {
                    format: timeFormat,
                    cancelLabel: 'Clear'
                },
                autoUpdateInput: false
            });

            dp.on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format(timeFormat) + ' - ' + picker.endDate.format(timeFormat));
            });

            dp.on('cancel.daterangepicker', function(ev, picker) {
                $(this).val('');
            });

            $('.date_range_reset').on('click', function () {
                $('.date-range-time').val('');
            })
        });
    </script>
{% endblock %}